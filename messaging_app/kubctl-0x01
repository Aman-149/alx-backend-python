#!/bin/bash
# Scaling script (conceptual)

echo "Scaling deployment to 3 replicas..."
echo "kubectl scale deployment messaging-app --replicas=3"
kubectl apply -f blue_deployment.yaml
kubectl apply -f green_deployment.yaml
kubectl rollout status deployment/messaging-app-green --timeout=90s || echo "Green deployment not ready"

GREEN_POD=$(kubectl get pods -l app=messaging-app,version=green -o jsonpath='{.items[0].metadata.name}')
kubectl logs "$GREEN_POD" --tail=10 || echo "Unable to fetch logs"

echo "Verifying running pods..."
echo "kubectl get pods"
kubectl patch service messaging-app \
  -p '{"spec": {"selector": {"app": "messaging-app", "version": "green"}}}'

kubectl get service messaging-app -o yaml | grep "selector" -A 2
echo "Monitoring resource usage..."
echo "kubectl top pods"
